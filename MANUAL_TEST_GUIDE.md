# æ‰‹åŠ¨æµ‹è¯•æŒ‡å— - Hair Style AI

## ğŸ¯ æµ‹è¯•ç›®æ ‡
éªŒè¯å®Œæ•´çš„ç”¨æˆ·æ³¨å†Œ â†’ è´­ä¹° â†’ è®¢é˜… â†’ ç§¯åˆ†æµç¨‹

## ğŸ“‹ é¢„å¤‡æ­¥éª¤

### 1. ç¡®ä¿ordersè¡¨å·²åˆ›å»º
```bash
# åœ¨Supabase SQLç¼–è¾‘å™¨ä¸­æ‰§è¡Œä»¥ä¸‹è„šæœ¬
cat scripts/create-orders-table.sql
```

### 2. æ£€æŸ¥ç¯å¢ƒå˜é‡
ç¡®ä¿ä»¥ä¸‹ç¯å¢ƒå˜é‡å·²æ­£ç¡®é…ç½®ï¼š
- `NEXT_PUBLIC_SUPABASE_URL`
- `SUPABASE_SERVICE_ROLE_KEY`
- `CREEM_API_KEY`

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### æ­¥éª¤1: ç”¨æˆ·æ³¨å†Œ/ç™»å½•
1. è®¿é—® `/signin` é¡µé¢
2. ä½¿ç”¨Google OAuthç™»å½•
3. ç™»å½•æˆåŠŸåï¼Œæ£€æŸ¥æ˜¯å¦åˆ›å»ºäº†ç”¨æˆ·profile

**éªŒè¯å‘½ä»¤**:
```bash
curl -X GET http://localhost:3000/api/test-auth
```

**æœŸæœ›ç»“æœ**:
```json
{
  "success": true,
  "authenticated": true,
  "user": {
    "id": "ç”¨æˆ·ID",
    "email": "ç”¨æˆ·é‚®ç®±",
    ...
  }
}
```

### æ­¥éª¤2: æ£€æŸ¥ç”¨æˆ·æ•°æ®
```bash
curl -X GET http://localhost:3000/api/creem/user-credits
```

**æœŸæœ›ç»“æœ**:
```json
{
  "success": true,
  "user": {
    "id": "ç”¨æˆ·ID",
    "email": "ç”¨æˆ·é‚®ç®±",
    "credits": 0,
    "hasActiveSubscription": false
  }
}
```

### æ­¥éª¤3: è¿›è¡Œè´­ä¹°
1. è®¿é—® `/pricing` é¡µé¢
2. é€‰æ‹©æœˆåº¦æˆ–å¹´åº¦è®¢é˜…
3. å®ŒæˆCreemæ”¯ä»˜æµç¨‹
4. ç­‰å¾…æ”¯ä»˜æˆåŠŸå›è°ƒ

### æ­¥éª¤4: éªŒè¯è´­ä¹°ç»“æœ

#### 4.1 æ£€æŸ¥ç”¨æˆ·ç§¯åˆ†å’Œè®¢é˜…
```bash
curl -X GET http://localhost:3000/api/creem/user-credits
```

**æœŸæœ›ç»“æœ**:
```json
{
  "success": true,
  "user": {
    "id": "ç”¨æˆ·ID",
    "credits": 500, // æœˆåº¦è®¢é˜…
    "hasActiveSubscription": true,
    "subscriptions": [
      {
        "plan_name": "monthly",
        "status": "active",
        "end_date": "æœªæ¥æ—¥æœŸ"
      }
    ]
  }
}
```

#### 4.2 æ£€æŸ¥è®¢å•è®°å½•
```bash
curl -X GET http://localhost:3000/api/orders
```

**æœŸæœ›ç»“æœ**:
```json
{
  "success": true,
  "orders": [
    {
      "order_id": "è®¢å•ID",
      "product_name": "monthly subscription",
      "status": "completed",
      "credits_granted": 500,
      "payment_date": "æ”¯ä»˜æ—¶é—´"
    }
  ],
  "total": 1
}
```

### æ­¥éª¤5: æµ‹è¯•ç§¯åˆ†æ¶ˆè´¹
1. è®¿é—®AIå‘å‹ç”ŸæˆåŠŸèƒ½
2. ä¸Šä¼ å›¾ç‰‡å¹¶ç”Ÿæˆå‘å‹
3. æ£€æŸ¥ç§¯åˆ†æ˜¯å¦æ­£ç¡®æ‰£é™¤

**éªŒè¯å‘½ä»¤**:
```bash
curl -X GET http://localhost:3000/api/creem/user-credits
```

**æœŸæœ›ç»“æœ**: ç§¯åˆ†åº”è¯¥å‡å°‘10åˆ†

## ğŸ” è°ƒè¯•å‘½ä»¤

### æ£€æŸ¥æ•°æ®åº“è¿æ¥
```bash
curl -X GET http://localhost:3000/api/debug/supabase-test
```

### æ£€æŸ¥ç§¯åˆ†çŠ¶æ€
```bash
curl -X GET http://localhost:3000/api/debug/check-credits
```

### ä¿®å¤ç§¯åˆ†ï¼ˆå¦‚æœéœ€è¦ï¼‰
```bash
curl -X POST http://localhost:3000/api/fix-credits \
  -H "Content-Type: application/json" \
  -d '{"action": "add_credits", "amount": 500}'
```

## âš ï¸ å¸¸è§é—®é¢˜

### é—®é¢˜1: ç”¨æˆ·ç™»å½•åæ²¡æœ‰profile
**åŸå› **: è®¤è¯å›è°ƒå¯èƒ½å¤±è´¥  
**è§£å†³**: æ£€æŸ¥ `/api/auth/callback` æ—¥å¿—

### é—®é¢˜2: è´­ä¹°åæ²¡æœ‰ç§¯åˆ†
**åŸå› **: Webhookå¤„ç†å¤±è´¥  
**è§£å†³**: æ£€æŸ¥ `/api/creem/webhook` æ—¥å¿—

### é—®é¢˜3: è®¢å•è®°å½•ç¼ºå¤±
**åŸå› **: ordersè¡¨å¯èƒ½ä¸å­˜åœ¨  
**è§£å†³**: æ‰§è¡Œ `scripts/create-orders-table.sql`

## ğŸ“Š æµ‹è¯•éªŒè¯æ¸…å•

- [ ] âœ… ç”¨æˆ·å¯ä»¥æˆåŠŸç™»å½•
- [ ] âœ… ç™»å½•ååˆ›å»ºäº†ç”¨æˆ·profile
- [ ] âœ… ç”¨æˆ·å¯ä»¥æŸ¥çœ‹pricingé¡µé¢
- [ ] âœ… ç”¨æˆ·å¯ä»¥å‘èµ·æ”¯ä»˜
- [ ] âœ… æ”¯ä»˜æˆåŠŸååˆ›å»ºäº†è®¢é˜…è®°å½•
- [ ] âœ… æ”¯ä»˜æˆåŠŸååˆ›å»ºäº†è®¢å•è®°å½•
- [ ] âœ… æ”¯ä»˜æˆåŠŸååˆ†é…äº†æ­£ç¡®çš„ç§¯åˆ†
- [ ] âœ… ç”¨æˆ·çŠ¶æ€æ›´æ–°ä¸ºæœ‰è®¿é—®æƒé™
- [ ] âœ… ç§¯åˆ†æ¶ˆè´¹åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [ ] âœ… ç§¯åˆ†è®¡ç®—å‡†ç¡®æ— è¯¯

## ğŸ‰ æˆåŠŸæ ‡å‡†

**å…¨éƒ¨é€šè¿‡çš„æ¡ä»¶**:
1. ç”¨æˆ·å¯ä»¥æ­£å¸¸ç™»å½•æ³¨å†Œ
2. è´­ä¹°æµç¨‹å®Œæ•´æ— é”™è¯¯
3. æ•°æ®æ­£ç¡®ä¿å­˜åˆ°æ‰€æœ‰ç›¸å…³è¡¨
4. ç§¯åˆ†ç³»ç»Ÿæ­£å¸¸è¿è¡Œ
5. ç”¨æˆ·å¯ä»¥æ­£å¸¸ä½¿ç”¨ä»˜è´¹åŠŸèƒ½

**å¦‚æœæµ‹è¯•å¤±è´¥**:
1. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯
2. æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—
3. ä½¿ç”¨è°ƒè¯•APIæ’æŸ¥é—®é¢˜
4. å‚è€ƒ `SYSTEM_CHECK_REPORT.md` ä¸­çš„è§£å†³æ–¹æ¡ˆ

---

*æµ‹è¯•æŒ‡å—æ›´æ–°æ—¶é—´: 2025-07-11*  
*é€‚ç”¨ç‰ˆæœ¬: å½“å‰å¼€å‘ç‰ˆæœ¬* 